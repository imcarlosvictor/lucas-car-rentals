{% extends "customer/base.html" %}
{% load static %}

{% block title %}Payment{% endblock %}

{% block content %}
<div class="content">
	<p class="title">Payment Method</p>
	<form action="/checkout" id="hosted-fields-form" method="post" class="checkout-form">
		{% csrf_token %}
		<label for="card-number">Card Number</label>
		<div id="card-number"></div>

		<label for="cvv">CVV</label>
		<div id="cvv"></div>

		<label for="expiration-date">Expiration Date</label>
		<div id="expiration-date"></div>
		<input type="hidden" id="nonce" name="payment_method_nonce" value="">

		<div id="checkout-message"></div>

		<input id="payment-button" type="submit" value="Pay">
	</form>

	<div id="paypal-button"></div>

	<script>
		var form = document.querySelector('#hosted-fields-form');
		var submit = document.querySelector('input[type="submit"]');

		braintree.client.create({
			// Insert your tokenization key here
			authorization: '{{ client_token }}'
		}, function (clientErr, clientInstance) {
			if (clientErr) {
				console.error(clientErr);
				return;
			}

			// Create a hostedFields component to initialize the form

			braintree.hostedFields.create({
				client: clientInstance,
				// Customize the Hosted Fields.
				// More information can be found at:
				// https://developers.braintreepayments.com/guides/hosted-fields/styling/javascript/v3
				styles: {
					'input': { 'font-size': '14px' },
					'input.invalid': { 'color': 'red' },
					'input.valid': { 'color': 'green' }
				},
				// Configure which fields in your card form will be generated by Hosted Fields instead
				fields: {
					number: {
						container: '#card-number',
						placeholder: '4111 1111 1111 1111'
					},
					cvv: {
						container: '#cvv',
						placeholder: '123'
					},
					expirationDate: {
						container: '#expiration-date',
						placeholder: '10/2022'
					}
				}
			}, function (hostedFieldsErr, instance) {
				if (hostedFieldsErr) {
					console.error(hostedFieldsErr);
					return;
				}

				// Once the fields are initialized enable the submit button
				submit.removeAttribute('disabled');
				// Initialize the form submit event
				form.addEventListener('submit', function (event) {
					event.preventDefault();
					// When the user clicks on the 'Submit payment' button this code will send the
					// encrypted payment information in a variable called a payment method nonce
					instance.tokenize(function (tokenizeErr, payload) {
						if (tokenizeErr) {
							console.error(tokenizeErr);
							return;
						}

						document.getElementById('nonce').value = payload.nonce;
						document.getElementById('payment-button').submit();

					});
				}, false);
			});
		});
	</script>

</div>
{% endblock %}
